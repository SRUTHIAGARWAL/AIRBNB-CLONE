<% layout("/layout/boilerplate") -%><body>
        <script>
            let maptoken="<%= process.env.MAP_TOKEN%>";
            const coordinates=<%- JSON.stringify(list.geometry.coordinates) %>;
            const listing= <%- JSON.stringify(list) %>;
        </script>
        <div class="row">
        <div class="card col-6 offset-3 listing-card" style="margin-top: 1rem;">

            <img src="<%= list.image.url %>" class="card-img-top" style="height: 30vh;" alt="Image of <%= list.title %>">
            <div class="card-body show-card">
                <h5 class="card-title">
                    <%= list.title %>
                </h5>
                
                <p class="card-text">owned by <%= list.owner ? list.owner.username:"unknown" %></p>
                <p class="card-text"><%= list.price %> <br>
                <%= list.description %><br>
               <%= list.location %><br>
               <%= list.country %><br>
                </p>
                <% if(currUser && list.owner._id.equals(currUser._id)) {%>
                <div class="d-flex justify-content-between mt-3">
                    <form method="GET" action="/listing/<%= list._id %>/edit">
                        <button class="btn btn-dark">Edit</button>
                    </form>
                
                    <form method="POST" action="/listing/<%= list._id %>?_method=DELETE">
                        <button class="btn btn-danger">Delete</button>
                    </form>
                </div>
                <% }%>
                </div>
            </div>
            <div class="card listing-card col-6 offset-3 mb-3">
                <% if(currUser) {%>
                <h5>LEAVE A REVIEW</h5>
                <form method="post" action="/listing/review/<%=list._id %>/addReview" novalidate class="needs-validation">
                    
<fieldset class="starability-heart">
    <input type="radio" id="first-rate1" name="rating" value="1" />
    <label for="first-rate1" title="Terrible">1 star</label>
    <input type="radio" id="first-rate2" name="rating" value="2" />
    <label for="first-rate2" title="Not good">2 stars</label>
    <input type="radio" id="first-rate3" name="rating" value="3" />
    <label for="first-rate3" title="Average">3 stars</label>
    <input type="radio" id="first-rate4" name="rating" value="4" />
    <label for="first-rate4" title="Very good">4 stars</label>
    <input type="radio" id="first-rate5" name="rating" value="5" />
    <label for="first-rate5" title="Amazing">5 stars</label>
  </fieldset>
                    <div class="form-floating">
                        <textarea class="form-control" name="comment" placeholder="Leave a comment here" id="comment"
                            style="height: 100px" required></textarea>
                        <label for="comment">Comments</label>
                        <div class="invalid-feedback">please add some review to submit</div>
                    </div>
                    
                </br>
                    <button type="submit" class="btn btn-dark">submit</button>
                </form>
                <% }%>
            </div >

            <div class="row col-6 offset-3">
            <h5>Reviews</h5>
                <% for(review of list.review) { %>
                <div class="card col-5 mb-3 ms-3" >
                    <div class="card-body" >
                            <h5><%= review.author.username %></h5>
                            <p class="starability-result card-text" data-rating="<%= review.rating%>">
                              </p>
                            <p class="card-text"> 
                                <%=review.comment%></p>

                    </div>
                    <form class="mb-3" method="post" action="/listing/review/<%= list._id%>/<%= review._id %>?_method=DELETE">
                    <button class="btn btn-sm btn-dark "  >DELETE</button>
                    </form>
                </div>
                <% } %> 
            </div>
            <div class="row col-6 offset-3">
                <h3>Where you will be</h3>
                <div id="map">
                    
                </div>
            </div>
           
        </div>
        <script src="/js/map.js">
          
        </script>
    </body>